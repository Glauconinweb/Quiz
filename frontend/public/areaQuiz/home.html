<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../stylee.css" />
    <title>Quiz Sustentável</title>
  </head>
  <body>
    <!-- Botão de abrir sidebar -->
    <button id="openSidebar" class="sidebar-toggle">☰</button>

    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar">
      <ul>
        <li><a href="#" onclick="logout()">Encerrar Sessão</a></li>
        <li><a href="#">Placar</a></li>
      </ul>
    </nav>

    <!-- Conteúdo principal -->
    <div
      id="placar"
      style="
        display: none;
        background: #fff;
        padding: 16px;
        border-radius: 8px;
        margin-top: 20px;
      "
    ></div>
    <div class="conteinerr">
      <h1>Quiz Sustentável</h1>

      <div class="quiz">
        <h2 id="question">Question goes here</h2>
        <div id="answer-buttons">
          <button class="btn">Answer 1</button>
          <button class="btn">Answer 2</button>
          <button class="btn">Answer 3</button>
          <button class="btn">Answer 4</button>
        </div>
        <button id="next-btn">Próxima</button>
      </div>
    </div>
    <script>
      if (!sessionStorage.getItem("usuarioLogado")) {
        window.location.href = "/index.html";
      }

      function logout() {
        sessionStorage.clear();
        window.location.href = "../index.html";
      }

      const sidebar = document.getElementById("sidebar");
      const openBtn = document.getElementById("openSidebar");

      openBtn.addEventListener("click", () => {
        sidebar.classList.toggle("active");
      });

      window.addEventListener("click", function (event) {
        if (
          !sidebar.contains(event.target) &&
          !openBtn.contains(event.target)
        ) {
          sidebar.classList.remove("active");
        }
      });
      // ...existing code...

      async function mostrarPlacar() {
        const placarDiv = document.getElementById("placar");
        placarDiv.innerHTML = "<b>Carregando placar...</b>";
        placarDiv.style.display = "block";
        try {
          const res = await fetch("http://localhost:3000/scores");
          const top = await res.json();
          if (top.length === 0) {
            placarDiv.innerHTML = "<b>Nenhum placar registrado ainda.</b>";
            return;
          }
          placarDiv.innerHTML = "<h2>Top 3 Jogadores</h2>";
          top.forEach((item, idx) => {
            placarDiv.innerHTML += `<p><b>${idx + 1}º</b> ${item.name}: ${
              item.score
            } pts</p>`;
          });
        } catch {
          placarDiv.innerHTML = "<b>Erro ao carregar placar.</b>";
        }
      }

      // Esconde o placar ao clicar fora dele ou na sidebar
      document
        .querySelector('a[href="#"]')
        .addEventListener("click", function (e) {
          if (this.textContent.includes("Placar")) {
            e.preventDefault();
            mostrarPlacar();
          }
          window.addEventListener("click", function (event) {
            const placarDiv = document.getElementById("placar");
            if (
              placarDiv.style.display === "block" &&
              !placarDiv.contains(event.target) &&
              !event.target.textContent.includes("Placar")
            ) {
              placarDiv.style.display = "none";
            }
          });
        });
    </script>

    <script src="/backend/controllers/quizController.js"></script>
  </body>
</html>
